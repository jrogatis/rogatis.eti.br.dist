{"version":3,"sources":["api/contactForm/contactForm.controller.js"],"names":["create","app","extend","from","host","secureConnection","port","transportMethod","auth","user","process","env","GMAIL_USER","pass","GMAIL_SECRET","set","__dirname","handleEntityNotFound","res","entity","status","end","handleError","statusCode","err","send","handleSendEmail","msg","mailer","template","bcc","to","email","subject","message","console","log","req","body","then"],"mappings":"AAAA;;;;;;;AAOA;;;;;QA8DgBA,M,GAAAA,M;;AA7DhB;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAIC,MAAM,wBAAV;;AAEA,wBAAOC,MAAP,CAAcD,GAAd,EAAmB;AACjBE,QAAM,oBADW;AAEjBC,QAAM,gBAFW,EAEO;AACxBC,oBAAkB,IAHD,EAGO;AACxBC,QAAM,GAJW,EAIN;AACXC,mBAAiB,MALA,EAKQ;AACzBC,QAAM;AACJC,UAAMC,QAAQC,GAAR,CAAYC,UADd;AAEJC,UAAMH,QAAQC,GAAR,CAAYG;AAFd;AANW,CAAnB;;AAYAb,IAAIc,GAAJ,CAAQ,OAAR,EAAiBC,YAAY,GAA7B;AACAf,IAAIc,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;;AAGA,SAASE,oBAAT,CAA8BC,GAA9B,EAAmC;AACjC,SAAO,UAAUC,MAAV,EAAkB;AACvB,QAAI,CAACA,MAAL,EAAa;AACXD,UAAIE,MAAJ,CAAW,GAAX,EAAgBC,GAAhB;AACA,aAAO,IAAP;AACD;AACD,WAAOF,MAAP;AACD,GAND;AAOD;;AAED,SAASG,WAAT,CAAqBJ,GAArB,EAA0BK,UAA1B,EAAsC;AACpCA,eAAaA,cAAc,GAA3B;AACA,SAAO,UAAUC,GAAV,EAAe;AACpBN,QAAIE,MAAJ,CAAWG,UAAX,EAAuBE,IAAvB,CAA4BD,GAA5B;AACD,GAFD;AAGD;;AAED,SAASE,eAAT,CAAyBR,GAAzB,EAA8BS,GAA9B,EAAmC;AACjC1B,MAAI2B,MAAJ,CAAWH,IAAX,CAAgB;AACdI,cAAU,OADI;AAEbC,SAAI;AAFS,GAAhB,EAIA;AACEC,QAAIJ,IAAIK,KADV;AAEEC,aAAS,wBAFX,EAEqC;AACnCC,aAASP,IAAIO;AAHf,GAJA,EAQG,UAAUV,GAAV,EAAe;AAChB,QAAIA,GAAJ,EAAS;AACP;AACAW,cAAQC,GAAR,CAAYZ,GAAZ;AACAN,UAAIO,IAAJ,CAAS,sCAAT;AACA;AACD;AACDP,QAAIO,IAAJ,CAAS,YAAT;AACD,GAhBD;AAiBD;;AAED;AACO,SAASzB,MAAT,CAAgBqC,GAAhB,EAAqBnB,GAArB,EAA0B;AAC/B,SAAO,sBAAYlB,MAAZ,CAAmBqC,IAAIC,IAAvB,EACJC,IADI,CACCb,gBAAgBR,GAAhB,EAAqBmB,IAAIC,IAAzB,CADD,CAAP;AAGD","file":"contactForm.controller.js","sourcesContent":["/**\n * Using Rails-like standard naming convention for endpoints.\n\n * POST    /api/ContactForm              ->  create\n\n */\n\n'use strict';\nimport jsonpatch from 'fast-json-patch';\nimport ContactForm from './contactForm.model';\nimport express from 'express';\nimport mailer from 'express-mailer';\n\nvar app = express();\n\nmailer.extend(app, {\n  from: 'jrogatis@gmail.com',\n  host: 'smtp.gmail.com', // hostname\n  secureConnection: true, // use SSL\n  port: 465, // port for secure SMTP\n  transportMethod: 'SMTP', // default is SMTP. Accepts anything that nodemailer accepts\n  auth: {\n    user: process.env.GMAIL_USER,\n    pass: process.env.GMAIL_SECRET\n  }\n});\n\napp.set('views', __dirname + '/');\napp.set('view engine', 'pug');\n\n\nfunction handleEntityNotFound(res) {\n  return function (entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function (err) {\n    res.status(statusCode).send(err);\n  };\n}\n\nfunction handleSendEmail(res, msg) {\n  app.mailer.send({\n    template: 'email',\n     bcc:'jrogatis@metaconexao.com.br'\n  },\n  {\n    to: msg.email,\n    subject: 'Your contact with Jean', // REQUIRED.\n    message: msg.message,\n  }, function (err) {\n    if (err) {\n      // handle error\n      console.log(err);\n      res.send('There was an error sending the email');\n      return;\n    }\n    res.send('Email Sent');\n  });\n}\n\n// Creates a new ContactForm in the DB\nexport function create(req, res) {\n  return ContactForm.create(req.body)\n    .then(handleSendEmail(res, req.body))\n\n}\n"]}
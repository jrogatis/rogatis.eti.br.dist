{"version":3,"sources":["api/contactForm/contactForm.controller.js"],"names":["create","app","extend","from","host","secureConnection","port","transportMethod","auth","user","process","env","GMAIL_USER","pass","GMAIL_SECRET","set","__dirname","handleEntityNotFound","res","entity","status","end","handleError","statusCode","err","send","handleSendEmail","msg","console","log","mailer","to","email","subject","otherProperty","req","body","then"],"mappings":"AAAA;;;;;;;AAOA;;;;;QA2DgBA,M,GAAAA,M;;AA1DhB;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAIC,MAAM,wBAAV;;AAEA,wBAAOC,MAAP,CAAcD,GAAd,EAAmB;AACjBE,QAAM,oBADW;AAEjBC,QAAM,gBAFW,EAEO;AACxBC,oBAAkB,IAHD,EAGO;AACxBC,QAAM,GAJW,EAIN;AACXC,mBAAiB,MALA,EAKQ;AACzBC,QAAM;AACJC,UAAMC,QAAQC,GAAR,CAAYC,UADd;AAEJC,UAAMH,QAAQC,GAAR,CAAYG;AAFd;AANW,CAAnB;;AAYAb,IAAIc,GAAJ,CAAQ,OAAR,EAAiBC,YAAY,GAA7B;AACAf,IAAIc,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;;AAGA,SAASE,oBAAT,CAA8BC,GAA9B,EAAmC;AACjC,SAAO,UAAUC,MAAV,EAAkB;AACvB,QAAI,CAACA,MAAL,EAAa;AACXD,UAAIE,MAAJ,CAAW,GAAX,EAAgBC,GAAhB;AACA,aAAO,IAAP;AACD;AACD,WAAOF,MAAP;AACD,GAND;AAOD;;AAED,SAASG,WAAT,CAAqBJ,GAArB,EAA0BK,UAA1B,EAAsC;AACpCA,eAAaA,cAAc,GAA3B;AACA,SAAO,UAAUC,GAAV,EAAe;AACpBN,QAAIE,MAAJ,CAAWG,UAAX,EAAuBE,IAAvB,CAA4BD,GAA5B;AACD,GAFD;AAGD;;AAED,SAASE,eAAT,CAAyBR,GAAzB,EAA8BS,GAA9B,EAAmC;AACjCC,UAAQC,GAAR,CAAY,UAAZ,EAAwBnB,QAAQC,GAAhC;AACAV,MAAI6B,MAAJ,CAAWL,IAAX,CAAgB,OAAhB,EAAyB;AACvBM,QAAIJ,IAAIK,KADe;AAEvBC,aAAS,uBAFc,EAEW;AAClCC,mBAAe,gBAHQ,CAGS;AAHT,GAAzB,EAIG,UAAUV,GAAV,EAAe;AAChB,QAAIA,GAAJ,EAAS;AACP;AACAI,cAAQC,GAAR,CAAYL,GAAZ;AACAN,UAAIO,IAAJ,CAAS,sCAAT;AACA;AACD;AACDP,QAAIO,IAAJ,CAAS,YAAT;AACD,GAZD;AAaD;;AAED;AACO,SAASzB,MAAT,CAAgBmC,GAAhB,EAAqBjB,GAArB,EAA0B;AAC/B,SAAO,sBAAYlB,MAAZ,CAAmBmC,IAAIC,IAAvB,EACJC,IADI,CACCX,gBAAgBR,GAAhB,EAAqBiB,IAAIC,IAAzB,CADD,CAAP;AAGD","file":"contactForm.controller.js","sourcesContent":["/**\n * Using Rails-like standard naming convention for endpoints.\n\n * POST    /api/ContactForm              ->  create\n\n */\n\n'use strict';\nimport jsonpatch from 'fast-json-patch';\nimport ContactForm from './contactForm.model';\nimport express from 'express';\nimport mailer from 'express-mailer';\n\nvar app = express();\n\nmailer.extend(app, {\n  from: 'jrogatis@gmail.com',\n  host: 'smtp.gmail.com', // hostname\n  secureConnection: true, // use SSL\n  port: 465, // port for secure SMTP\n  transportMethod: 'SMTP', // default is SMTP. Accepts anything that nodemailer accepts\n  auth: {\n    user: process.env.GMAIL_USER,\n    pass: process.env.GMAIL_SECRET\n  }\n});\n\napp.set('views', __dirname + '/');\napp.set('view engine', 'pug');\n\n\nfunction handleEntityNotFound(res) {\n  return function (entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function (err) {\n    res.status(statusCode).send(err);\n  };\n}\n\nfunction handleSendEmail(res, msg) {\n  console.log('no email', process.env)\n  app.mailer.send('email', {\n    to: msg.email,\n    subject: 'Your contact for Jean', // REQUIRED.\n    otherProperty: 'Other Property' // All additional properties are also passed to the template as local variables.\n  }, function (err) {\n    if (err) {\n      // handle error\n      console.log(err);\n      res.send('There was an error sending the email');\n      return;\n    }\n    res.send('Email Sent');\n  });\n}\n\n// Creates a new ContactForm in the DB\nexport function create(req, res) {\n  return ContactForm.create(req.body)\n    .then(handleSendEmail(res, req.body))\n\n}\n"]}
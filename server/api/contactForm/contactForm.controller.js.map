{"version":3,"sources":["api/contactForm/contactForm.controller.js"],"names":["create","app","extend","from","host","secureConnection","port","transportMethod","auth","user","process","env","GMAIL_USER","pass","GMAIL_SECRET","set","__dirname","respondWithResult","res","statusCode","entity","status","json","handleSendEmail","console","log","mailer","send","template","bcc","to","email","subject","message","err","req","body","then"],"mappings":"AAAA;;;;;;AAMA;;;;;QAuDgBA,M,GAAAA,M;;AAtDhB;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAIC,MAAM,wBAAV;;AAEA,wBAAOC,MAAP,CAAcD,GAAd,EAAmB;AACjBE,QAAM,6CADW;AAEjBC,QAAM,gBAFW,EAEO;AACxBC,oBAAkB,IAHD,EAGO;AACxBC,QAAM,GAJW,EAIN;AACXC,mBAAiB,MALA,EAKQ;AACzBC,QAAM;AACJC,UAAMC,QAAQC,GAAR,CAAYC,UADd;AAEJC,UAAMH,QAAQC,GAAR,CAAYG;AAFd;AANW,CAAnB;;AAYAb,IAAIc,GAAJ,CAAQ,OAAR,EAAqBC,SAArB,Q,CAAoC;AACpCf,IAAIc,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;;AAEA,SAASE,iBAAT,CAA2BC,GAA3B,EAAgCC,UAAhC,EAA4C;AAC1CA,eAAaA,cAAc,GAA3B;AACA,SAAO,UAASC,MAAT,EAAiB;AACtB,QAAGA,MAAH,EAAW;AACT,aAAOF,IAAIG,MAAJ,CAAWF,UAAX,EAAuBG,IAAvB,CAA4BF,MAA5B,CAAP;AACD;AACD,WAAO,IAAP;AACD,GALD;AAMD;;AAED,SAASG,eAAT,CAAyBL,GAAzB,EAA8B;AAC5BM,UAAQC,GAAR,CAAY,MAAZ,EAAoBT,SAApB;AACAf,MAAIyB,MAAJ,CAAWC,IAAX,CAAgB;AACdC,cAAU,OADI;AAEdC,SAAK;AAFS,GAAhB,EAIE;AACEC,QAAIZ,IAAIa,KADV;AAEEC,aAAS,wBAFX,EAEqC;AACnCC,aAASf,IAAIe;AAHf,GAJF,EAQK,eAAO;AACR,QAAGC,GAAH,EAAQ;AACN;AACAV,cAAQC,GAAR,CAAYS,GAAZ;AACAhB,UAAIS,IAAJ,CAAS,sCAAT;AACA;AACD;AACFT,QAAIS,IAAJ,CAAS,YAAT;AACA,GAhBH;AAiBD;;AAED;AACO,SAAS3B,MAAT,CAAgBmC,GAAhB,EAAqBjB,GAArB,EAA0B;AAC/B,SAAO,sBAAYlB,MAAZ,CAAmBmC,IAAIC,IAAvB,EACJC,IADI,CACCd,gBAAgBL,GAAhB,CADD,CAAP;AAED","file":"contactForm.controller.js","sourcesContent":["/**\n * Using Rails-like standard naming convention for endpoints.\n\n * POST    /api/ContactForm              ->  create\n\n */\n'use strict';\nimport ContactForm from './contactForm.model';\nimport express from 'express';\nimport mailer from 'express-mailer';\nimport path from 'path';\n\nvar app = express();\n\nmailer.extend(app, {\n  from: 'Jean Philip de Rogatis <jrogatis@gmail.com>',\n  host: 'smtp.gmail.com', // hostname\n  secureConnection: true, // use SSL\n  port: 465, // port for secure SMTP\n  transportMethod: 'SMTP', // default is SMTP. Accepts anything that nodemailer accepts\n  auth: {\n    user: process.env.GMAIL_USER,\n    pass: process.env.GMAIL_SECRET\n  }\n});\n\napp.set('views', `${ __dirname}/` );//path.resolve( __dirname, '/'));\napp.set('view engine', 'pug');\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if(entity) {\n      return res.status(statusCode).json(entity);\n    }\n    return null;\n  };\n}\n\nfunction handleSendEmail(res) {\n  console.log('path', __dirname);\n  app.mailer.send({\n    template: 'email',\n    bcc: 'jrogatis@metaconexao.com.br'\n  },\n    {\n      to: res.email,\n      subject: 'Your contact with Jean', // REQUIRED.\n      message: res.message\n    }, err => {\n      if(err) {\n        // handle error\n        console.log(err);\n        res.send('There was an error sending the email');\n        return;\n      }\n     res.send('Email Sent');\n    });\n}\n\n// Creates a new ContactForm in the DB\nexport function create(req, res) {\n  return ContactForm.create(req.body)\n    .then(handleSendEmail(res));\n}\n"]}